
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Cryptography Introduction (with .NET code example) &#8212; binwei  documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <link rel="author" title="About these documents" href="../../about/" />
    <link rel="index" title="Index" href="../../genindex/" />
    <link rel="search" title="Search" href="../../search/" />
  
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  
  <link rel="alternate" type="application/atom+xml"  href="../../blog/atom.xml" title="binwei Blog">
  
  
  <link href="True" rel="stylesheet">
  
  <style type="text/css">
    ul.ablog-archive {list-style: none; overflow: auto; margin-left: 0px}
    ul.ablog-archive li {float: left; margin-right: 5px; font-size: 80%}
    ul.postlist a {font-style: italic;}
    ul.postlist-style-disc {list-style-type: disc;}
    ul.postlist-style-none {list-style-type: none;}
    ul.postlist-style-circle {list-style-type: circle;}
  </style>

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="cryptography-introduction-with-net-code-example">
<h1><a class="toc-backref" href="#id1">Cryptography Introduction (with .NET code example)</a><a class="headerlink" href="#cryptography-introduction-with-net-code-example" title="Permalink to this headline">¶</a></h1>
<p>Cryptography is the core part of security, this blog introduces the basic concepts in cryptography and uses .NET as code example.</p>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#cryptography-introduction-with-net-code-example" id="id1">Cryptography Introduction (with .NET code example)</a></p></li>
<li><p><a class="reference internal" href="#randomness" id="id2">Randomness</a></p></li>
<li><p><a class="reference internal" href="#hashing" id="id3">Hashing</a></p>
<ul>
<li><p><a class="reference internal" href="#hash-algorithm-with-key" id="id4">Hash algorithm with key</a></p></li>
<li><p><a class="reference internal" href="#store-password" id="id5">Store Password</a></p></li>
<li><p><a class="reference internal" href="#pbkdf" id="id6">PBKDF</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#symmetric-algorithm" id="id7">Symmetric Algorithm</a></p></li>
<li><p><a class="reference internal" href="#asymmetric-encryption" id="id8">Asymmetric Encryption</a></p></li>
<li><p><a class="reference internal" href="#digital-signatures" id="id9">Digital Signatures</a></p>
<ul>
<li><p><a class="reference internal" href="#comparision-between-hashing-mac-and-digital-sign" id="id10">Comparision between hashing, MAC and digital sign</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#secure-string" id="id11">Secure String</a></p></li>
</ul>
</div>
</div>
<div class="section" id="randomness">
<h1><a class="toc-backref" href="#id2">Randomness</a><a class="headerlink" href="#randomness" title="Permalink to this headline">¶</a></h1>
<p>System.Random and its problems</p>
<ul class="simple">
<li><p>System.Random is a pseudo random number generator</p></li>
<li><p>A seed value is passed into the constructor</p></li>
<li><p>The seed value should be different each time</p></li>
<li><p>System.Random is deterministic and predictable</p></li>
</ul>
<p>Solution is to use RNGCryptoServiceProvider instead.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="n">static</span> <span class="n">byte</span><span class="p">[]</span> <span class="n">GenerateRandomNumber</span><span class="p">(</span><span class="nb">int</span> <span class="n">length</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">using</span> <span class="p">(</span><span class="n">var</span> <span class="n">randomNumberGenerator</span> <span class="o">=</span> <span class="n">new</span> <span class="n">RNGCryptoServiceProvider</span><span class="p">())</span>
  <span class="p">{</span>
    <span class="n">var</span> <span class="n">randomNumber</span> <span class="o">=</span> <span class="n">new</span> <span class="n">byte</span><span class="p">[</span><span class="n">length</span><span class="p">];</span>
    <span class="n">randomNumberGenerator</span><span class="o">.</span><span class="n">GetBytes</span><span class="p">((</span><span class="n">randomNumber</span><span class="p">));</span>

    <span class="k">return</span> <span class="n">randomNumber</span><span class="p">;</span>
  <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="hashing">
<h1><a class="toc-backref" href="#id3">Hashing</a><a class="headerlink" href="#hashing" title="Permalink to this headline">¶</a></h1>
<p>What Is Hashing?</p>
<ul class="simple">
<li><p>It is easy to compute the hash value for any given message</p></li>
<li><p>It is infeasible to generate a message that has a given hash</p></li>
<li><p>It is infeasible to modify a message without changing the hash</p></li>
<li><p>It is infeasible to find two different messages with the same hash</p></li>
</ul>
<p>Hash algorithm</p>
<ul class="simple">
<li><p>MD5</p></li>
<li><p>SHA-1</p></li>
<li><p>SHA-256</p></li>
<li><p>SHA-512</p></li>
</ul>
<p>Hashing is one way operation, while encryption is two way operation.</p>
<p>MD5</p>
<ul class="simple">
<li><p>Designed by Ron Rivest in 1991 to replace MD4</p></li>
<li><p>Produces a 128 bit (16 byte) hash value</p></li>
<li><p>Commonly used to verify file integrity</p></li>
<li><p>First collision resistance flaw found in 1996</p></li>
<li><p>Recommendation was to move over to the Secure Hash Family</p></li>
<li><p>Further collision resistance problems found in 2004</p></li>
<li><p>Still needed when integrating with legacy systems</p></li>
</ul>
<p>SHA1
SHA2: SHA256, SHA512
SHA3: not supported in .net so far (2015)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="k">class</span> <span class="nc">HashData</span>
<span class="p">{</span>
  <span class="n">public</span> <span class="n">static</span> <span class="n">byte</span><span class="p">[]</span> <span class="n">ComputeHashSha1</span><span class="p">(</span><span class="n">byte</span><span class="p">[]</span> <span class="n">toBeHashed</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">using</span> <span class="p">(</span><span class="n">var</span> <span class="n">sha1</span> <span class="o">=</span> <span class="n">SHA1</span><span class="o">.</span><span class="n">Create</span><span class="p">())</span>
    <span class="p">{</span>
      <span class="k">return</span> <span class="n">sha1</span><span class="o">.</span><span class="n">ComputeHash</span><span class="p">(</span><span class="n">toBeHashed</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">public</span> <span class="n">static</span> <span class="n">byte</span><span class="p">[]</span> <span class="n">ComputeHashSha256</span><span class="p">(</span><span class="n">byte</span><span class="p">[]</span> <span class="n">toBeHashed</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">using</span> <span class="p">(</span><span class="n">var</span> <span class="n">sha256</span> <span class="o">=</span> <span class="n">SHA256</span><span class="o">.</span><span class="n">Create</span><span class="p">())</span>
    <span class="p">{</span>
      <span class="k">return</span> <span class="n">sha256</span><span class="o">.</span><span class="n">ComputeHash</span><span class="p">(</span><span class="n">toBeHashed</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">public</span> <span class="n">static</span> <span class="n">byte</span><span class="p">[]</span> <span class="n">ComputeHashSha512</span><span class="p">(</span><span class="n">byte</span><span class="p">[]</span> <span class="n">toBeHashed</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">using</span> <span class="p">(</span><span class="n">var</span> <span class="n">sha512</span> <span class="o">=</span> <span class="n">SHA512</span><span class="o">.</span><span class="n">Create</span><span class="p">())</span>
    <span class="p">{</span>
      <span class="k">return</span> <span class="n">sha512</span><span class="o">.</span><span class="n">ComputeHash</span><span class="p">(</span><span class="n">toBeHashed</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">public</span> <span class="n">static</span> <span class="n">byte</span><span class="p">[]</span> <span class="n">ComputeHashMd5</span><span class="p">(</span><span class="n">byte</span><span class="p">[]</span> <span class="n">toBeHashed</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">using</span> <span class="p">(</span><span class="n">var</span> <span class="n">md5</span> <span class="o">=</span> <span class="n">MD5</span><span class="o">.</span><span class="n">Create</span><span class="p">())</span>
    <span class="p">{</span>
      <span class="k">return</span> <span class="n">md5</span><span class="o">.</span><span class="n">ComputeHash</span><span class="p">(</span><span class="n">toBeHashed</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="hash-algorithm-with-key">
<h2><a class="toc-backref" href="#id4">Hash algorithm with key</a><a class="headerlink" href="#hash-algorithm-with-key" title="Permalink to this headline">¶</a></h2>
<p>Hashed Message Authentication Codes</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="k">class</span> <span class="nc">Hmac</span>
<span class="p">{</span>
    <span class="n">private</span> <span class="n">const</span> <span class="nb">int</span> <span class="n">KeySize</span> <span class="o">=</span> <span class="mi">32</span><span class="p">;</span>

    <span class="n">public</span> <span class="n">static</span> <span class="n">byte</span><span class="p">[]</span> <span class="n">GenerateRandomKey</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">using</span> <span class="p">(</span><span class="n">var</span> <span class="n">randomNumberGenerator</span> <span class="o">=</span> <span class="n">new</span> <span class="n">RNGCryptoServiceProvider</span><span class="p">())</span>
        <span class="p">{</span>
            <span class="n">var</span> <span class="n">randomNumber</span> <span class="o">=</span> <span class="n">new</span> <span class="n">byte</span><span class="p">[</span><span class="n">KeySize</span><span class="p">];</span>
            <span class="n">randomNumberGenerator</span><span class="o">.</span><span class="n">GetBytes</span><span class="p">((</span><span class="n">randomNumber</span><span class="p">));</span>

            <span class="k">return</span> <span class="n">randomNumber</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">static</span> <span class="n">byte</span><span class="p">[]</span> <span class="n">ComputeHmacsha256</span><span class="p">(</span><span class="n">byte</span><span class="p">[]</span> <span class="n">toBeHashed</span><span class="p">,</span> <span class="n">byte</span><span class="p">[]</span> <span class="n">key</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">using</span> <span class="p">(</span><span class="n">var</span> <span class="n">hmac</span> <span class="o">=</span> <span class="n">new</span> <span class="n">HMACSHA256</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">hmac</span><span class="o">.</span><span class="n">ComputeHash</span><span class="p">(</span><span class="n">toBeHashed</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">static</span> <span class="n">byte</span><span class="p">[]</span> <span class="n">ComputeHmacsha1</span><span class="p">(</span><span class="n">byte</span><span class="p">[]</span> <span class="n">toBeHashed</span><span class="p">,</span> <span class="n">byte</span><span class="p">[]</span> <span class="n">key</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">using</span> <span class="p">(</span><span class="n">var</span> <span class="n">hmac</span> <span class="o">=</span> <span class="n">new</span> <span class="n">HMACSHA1</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">hmac</span><span class="o">.</span><span class="n">ComputeHash</span><span class="p">(</span><span class="n">toBeHashed</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="store-password">
<h2><a class="toc-backref" href="#id5">Store Password</a><a class="headerlink" href="#store-password" title="Permalink to this headline">¶</a></h2>
<p>Store password: store plain text and encrypted password is not good idea.
Store hash since it cannot be reversed.</p>
<img alt="../../_images/hack_password.jpg" src="../../_images/hack_password.jpg" />
<p>Rainbow table contains pre-computed hash to speed up the attack.
Add salt will make brute force and rainbow table attack ineffective.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="k">class</span> <span class="nc">Hash</span>
<span class="p">{</span>
    <span class="n">public</span> <span class="n">static</span> <span class="n">byte</span><span class="p">[]</span> <span class="n">GenerateSalt</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">const</span> <span class="nb">int</span> <span class="n">saltLength</span> <span class="o">=</span> <span class="mi">32</span><span class="p">;</span>
        <span class="n">using</span> <span class="p">(</span><span class="n">var</span> <span class="n">randomNumberGenerator</span> <span class="o">=</span> <span class="n">new</span> <span class="n">RNGCryptoServiceProvider</span><span class="p">())</span>
        <span class="p">{</span>
            <span class="n">var</span> <span class="n">randomNumber</span> <span class="o">=</span> <span class="n">new</span> <span class="n">byte</span><span class="p">[</span><span class="n">saltLength</span><span class="p">];</span>
            <span class="n">randomNumberGenerator</span><span class="o">.</span><span class="n">GetBytes</span><span class="p">(</span><span class="n">randomNumber</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">randomNumber</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">private</span> <span class="n">static</span> <span class="n">byte</span><span class="p">[]</span> <span class="n">Combine</span><span class="p">(</span><span class="n">byte</span><span class="p">[]</span> <span class="n">first</span><span class="p">,</span> <span class="n">byte</span><span class="p">[]</span> <span class="n">second</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">var</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">new</span> <span class="n">byte</span><span class="p">[</span><span class="n">first</span><span class="o">.</span><span class="n">Length</span> <span class="o">+</span> <span class="n">second</span><span class="o">.</span><span class="n">Length</span><span class="p">];</span>
        <span class="n">Buffer</span><span class="o">.</span><span class="n">BlockCopy</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ret</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">first</span><span class="o">.</span><span class="n">Length</span><span class="p">);</span>
        <span class="n">Buffer</span><span class="o">.</span><span class="n">BlockCopy</span><span class="p">(</span><span class="n">second</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ret</span><span class="p">,</span> <span class="n">first</span><span class="o">.</span><span class="n">Length</span><span class="p">,</span> <span class="n">second</span><span class="o">.</span><span class="n">Length</span><span class="p">);</span>

        <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">static</span> <span class="n">byte</span><span class="p">[]</span> <span class="n">HashPasswordWithSalt</span><span class="p">(</span><span class="n">byte</span><span class="p">[]</span> <span class="n">toBeHashed</span><span class="p">,</span> <span class="n">byte</span><span class="p">[]</span> <span class="n">salt</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">using</span> <span class="p">(</span><span class="n">var</span> <span class="n">sha256</span> <span class="o">=</span> <span class="n">SHA256</span><span class="o">.</span><span class="n">Create</span><span class="p">())</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">sha256</span><span class="o">.</span><span class="n">ComputeHash</span><span class="p">(</span><span class="n">Combine</span><span class="p">(</span><span class="n">toBeHashed</span><span class="p">,</span> <span class="n">salt</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="pbkdf">
<h2><a class="toc-backref" href="#id6">PBKDF</a><a class="headerlink" href="#pbkdf" title="Permalink to this headline">¶</a></h2>
<p>The salt does not have to be secret, which can be stored in the database.
If the computational power become bigger, it still has risk just by adding salt.</p>
<p>Password Based Key Derivation Functions</p>
<ul class="simple">
<li><p>Password Based Key Derivation Function (PBKDF2)</p></li>
<li><p>RSA Public Key Cryptographic Standards (PKCS #5 Version 2.0)</p></li>
<li><p>Internet Engineering Task Force RFC 2898 Specification</p></li>
</ul>
<img alt="../../_images/pbkdf.jpg" src="../../_images/pbkdf.jpg" />
<p>Number Iteration: numbers of hashing function, which can scale with increasing computational power</p>
<ul class="simple">
<li><p>Good default is 50,000 iterations</p></li>
<li><p>Balance number of iterations with acceptable performance</p></li>
<li><p>Ideally double number of iterations every 2 years</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="k">class</span> <span class="nc">Pbkdf2</span>
<span class="p">{</span>
    <span class="n">public</span> <span class="n">static</span> <span class="n">byte</span><span class="p">[]</span> <span class="n">GenerateSalt</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">using</span> <span class="p">(</span><span class="n">var</span> <span class="n">randomNumberGenerator</span> <span class="o">=</span> <span class="n">new</span> <span class="n">RNGCryptoServiceProvider</span><span class="p">())</span>
        <span class="p">{</span>
            <span class="n">var</span> <span class="n">randomNumber</span> <span class="o">=</span> <span class="n">new</span> <span class="n">byte</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
            <span class="n">randomNumberGenerator</span><span class="o">.</span><span class="n">GetBytes</span><span class="p">(</span><span class="n">randomNumber</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">randomNumber</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">static</span> <span class="n">byte</span><span class="p">[]</span> <span class="n">HashPassword</span><span class="p">(</span><span class="n">byte</span><span class="p">[]</span> <span class="n">toBeHashed</span><span class="p">,</span> <span class="n">byte</span><span class="p">[]</span> <span class="n">salt</span><span class="p">,</span> <span class="nb">int</span> <span class="n">numberOfRounds</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">using</span> <span class="p">(</span><span class="n">var</span> <span class="n">rfc2898</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Rfc2898DeriveBytes</span><span class="p">(</span><span class="n">toBeHashed</span><span class="p">,</span> <span class="n">salt</span><span class="p">,</span> <span class="n">numberOfRounds</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">rfc2898</span><span class="o">.</span><span class="n">GetBytes</span><span class="p">(</span><span class="mi">32</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="symmetric-algorithm">
<h1><a class="toc-backref" href="#id7">Symmetric Algorithm</a><a class="headerlink" href="#symmetric-algorithm" title="Permalink to this headline">¶</a></h1>
<p>Advantages of symmetric encryption:</p>
<ul class="simple">
<li><p>Extremely secure</p></li>
<li><p>Relatively fast</p></li>
</ul>
<p>Disadvantage:</p>
<ul class="simple">
<li><p>Key sharing</p></li>
<li><p>More damage if compromised</p></li>
</ul>
<p>A new variant designed called Triple DES, which is a simple way to increase key size without redesigning a new cipher.
Many former DES users now use Triple DES.
Triple DES involved applying DES three times with 2 or 3 different keys.
Triple DES was regarded as adequately secure, although it is quite slow.</p>
<img alt="../../_images/triple_des.jpg" src="../../_images/triple_des.jpg" />
<p>CLR uses a stream oriented design for cryptography.
Core of the design is CryptoStream.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="n">byte</span><span class="p">[]</span> <span class="n">Encrypt</span><span class="p">(</span><span class="n">byte</span><span class="p">[]</span> <span class="n">dataToEncrypt</span><span class="p">,</span> <span class="n">byte</span><span class="p">[]</span> <span class="n">key</span><span class="p">,</span> <span class="n">byte</span><span class="p">[]</span> <span class="n">iv</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">using</span> <span class="p">(</span><span class="n">var</span> <span class="n">des</span> <span class="o">=</span> <span class="n">new</span> <span class="n">DESCryptoServiceProvider</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="n">des</span><span class="o">.</span><span class="n">Mode</span> <span class="o">=</span> <span class="n">CipherMode</span><span class="o">.</span><span class="n">CBC</span><span class="p">;</span>
        <span class="n">des</span><span class="o">.</span><span class="n">Padding</span> <span class="o">=</span> <span class="n">PaddingMode</span><span class="o">.</span><span class="n">PKCS7</span><span class="p">;</span>
        <span class="n">des</span><span class="o">.</span><span class="n">Key</span> <span class="o">=</span> <span class="n">key</span><span class="p">;</span>
        <span class="n">des</span><span class="o">.</span><span class="n">IV</span> <span class="o">=</span> <span class="n">iv</span><span class="p">;</span>

        <span class="n">using</span> <span class="p">(</span><span class="n">var</span> <span class="n">memoryStream</span> <span class="o">=</span> <span class="n">new</span> <span class="n">MemoryStream</span><span class="p">())</span>
        <span class="p">{</span>
            <span class="n">var</span> <span class="n">cryptoStream</span> <span class="o">=</span> <span class="n">new</span> <span class="n">CryptoStream</span><span class="p">(</span><span class="n">memoryStream</span><span class="p">,</span> <span class="n">des</span><span class="o">.</span><span class="n">CreateEncryptor</span><span class="p">(),</span>
                <span class="n">CryptoStreamMode</span><span class="o">.</span><span class="n">Write</span><span class="p">);</span>
            <span class="n">cryptoStream</span><span class="o">.</span><span class="n">Write</span><span class="p">(</span><span class="n">dataToEncrypt</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dataToEncrypt</span><span class="o">.</span><span class="n">Length</span><span class="p">);</span>
            <span class="n">cryptoStream</span><span class="o">.</span><span class="n">FlushFinalBlock</span><span class="p">();</span>
            <span class="k">return</span> <span class="n">memoryStream</span><span class="o">.</span><span class="n">ToArray</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">public</span> <span class="n">byte</span><span class="p">[]</span> <span class="n">Decrypt</span><span class="p">(</span><span class="n">byte</span><span class="p">[]</span> <span class="n">dataToDecrypt</span><span class="p">,</span> <span class="n">byte</span><span class="p">[]</span> <span class="n">key</span><span class="p">,</span> <span class="n">byte</span><span class="p">[]</span> <span class="n">iv</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">using</span> <span class="p">(</span><span class="n">var</span> <span class="n">des</span> <span class="o">=</span> <span class="n">new</span> <span class="n">DESCryptoServiceProvider</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="n">des</span><span class="o">.</span><span class="n">Mode</span> <span class="o">=</span> <span class="n">CipherMode</span><span class="o">.</span><span class="n">CBC</span><span class="p">;</span>
        <span class="n">des</span><span class="o">.</span><span class="n">Padding</span> <span class="o">=</span> <span class="n">PaddingMode</span><span class="o">.</span><span class="n">PKCS7</span><span class="p">;</span>
        <span class="n">des</span><span class="o">.</span><span class="n">Key</span> <span class="o">=</span> <span class="n">key</span><span class="p">;</span>
        <span class="n">des</span><span class="o">.</span><span class="n">IV</span> <span class="o">=</span> <span class="n">iv</span><span class="p">;</span>

        <span class="n">using</span> <span class="p">(</span><span class="n">var</span> <span class="n">memoryStream</span> <span class="o">=</span> <span class="n">new</span> <span class="n">MemoryStream</span><span class="p">())</span>
        <span class="p">{</span>
            <span class="n">var</span> <span class="n">cryptoStream</span> <span class="o">=</span> <span class="n">new</span> <span class="n">CryptoStream</span><span class="p">(</span><span class="n">memoryStream</span><span class="p">,</span> <span class="n">des</span><span class="o">.</span><span class="n">CreateDecryptor</span><span class="p">(),</span>
                <span class="n">CryptoStreamMode</span><span class="o">.</span><span class="n">Write</span><span class="p">);</span>
            <span class="n">cryptoStream</span><span class="o">.</span><span class="n">Write</span><span class="p">(</span><span class="n">dataToDecrypt</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dataToDecrypt</span><span class="o">.</span><span class="n">Length</span><span class="p">);</span>
            <span class="n">cryptoStream</span><span class="o">.</span><span class="n">FlushFinalBlock</span><span class="p">();</span>
            <span class="k">return</span> <span class="n">memoryStream</span><span class="o">.</span><span class="n">ToArray</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>How does DES and Triple DES work?</p>
<ul class="simple">
<li><p>DES is a block cipher that transforms plaintext into ciphertext</p></li>
<li><p>DES uses a block size of 64 bits</p></li>
<li><p>Uses a 64 bits key only 56 bits are used by the algorithm</p></li>
<li><p>Supports different modes of operation</p></li>
</ul>
<img alt="../../_images/des.jpg" src="../../_images/des.jpg" />
<p>The history of AES</p>
<ul class="simple">
<li><p>Unlike DES, AES does not use a Feistel network</p></li>
<li><p>Uses 128 bit block size and 128, 192 or 256 bit keys</p></li>
<li><p>Based on a design known as a substitution - permutation network</p></li>
</ul>
<p>How Secure is AES against brute force attack?</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 40%" />
<col style="width: 60%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Key Size</p></td>
<td><p>Possible Combinations</p></td>
</tr>
<tr class="row-even"><td><p>1 bit</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-odd"><td><p>2 bit</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-even"><td><p>4 bit</p></td>
<td><p>16</p></td>
</tr>
<tr class="row-odd"><td><p>8 bit</p></td>
<td><p>256</p></td>
</tr>
<tr class="row-even"><td><p>16 bit</p></td>
<td><p>65536</p></td>
</tr>
<tr class="row-odd"><td><p>32 bit</p></td>
<td><p>4.2 x 10 <sup>9</sup></p></td>
</tr>
<tr class="row-even"><td><p>56 bit (DES)</p></td>
<td><p>7.2 x 10 <sup>16</sup></p></td>
</tr>
<tr class="row-odd"><td><p>64 bit</p></td>
<td><p>1.8 x 10 <sup>19</sup></p></td>
</tr>
<tr class="row-even"><td><p>128 bit (AES)</p></td>
<td><p>3.4 x 10 <sup>38</sup></p></td>
</tr>
<tr class="row-odd"><td><p>192 bit (AES)</p></td>
<td><p>6.2 x 10 <sup>57</sup></p></td>
</tr>
<tr class="row-even"><td><p>256 bit (AES)</p></td>
<td><p>1.1 x 10 <sup>77</sup></p></td>
</tr>
</tbody>
</table>
<p>.NET Framework libraries for symmetric algorithm:</p>
<ul class="simple">
<li><p>DESCryptoServiceProvider</p></li>
<li><p>TripleDESCryptoServiceProvider</p></li>
<li><p>AESCryptoServiceProvider</p></li>
</ul>
</div>
<div class="section" id="asymmetric-encryption">
<h1><a class="toc-backref" href="#id8">Asymmetric Encryption</a><a class="headerlink" href="#asymmetric-encryption" title="Permalink to this headline">¶</a></h1>
<p>RSA has 3 key sizes:</p>
<ul class="simple">
<li><p>1024 bit key</p></li>
<li><p>2048 bit key</p></li>
<li><p>4096 bit key</p></li>
</ul>
<p>Some facts about asymmetric encryption algorithm:</p>
<ul class="simple">
<li><p>Public and private keys are based on prime numbers</p></li>
<li><p>Factoring a number back into constituent prime numbers is hard</p></li>
</ul>
<p>RSA encryption and decryption is a mathematical operation based on modular math</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">private</span> <span class="n">RSAParameters</span> <span class="n">_publicKey</span><span class="p">;</span>

<span class="n">private</span> <span class="n">RSAParameters</span> <span class="n">_privateKey</span><span class="p">;</span>

<span class="n">public</span> <span class="n">void</span> <span class="n">AssignNewKey</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">using</span> <span class="p">(</span><span class="n">var</span> <span class="n">rsa</span> <span class="o">=</span> <span class="n">new</span> <span class="n">RSACryptoServiceProvider</span><span class="p">(</span><span class="mi">2048</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">rsa</span><span class="o">.</span><span class="n">PersistKeyInCsp</span> <span class="o">=</span> <span class="n">false</span><span class="p">;</span>
        <span class="n">this</span><span class="o">.</span><span class="n">_publicKey</span> <span class="o">=</span> <span class="n">rsa</span><span class="o">.</span><span class="n">ExportParameters</span><span class="p">(</span><span class="n">false</span><span class="p">);</span>
        <span class="n">this</span><span class="o">.</span><span class="n">_privateKey</span> <span class="o">=</span> <span class="n">rsa</span><span class="o">.</span><span class="n">ExportParameters</span><span class="p">(</span><span class="n">true</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>It is not recommended to store private key on your file system, try to use key container</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="n">void</span> <span class="n">AssignNewKeyWithContainer</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">const</span> <span class="nb">int</span> <span class="n">ProviderRsaFull</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">CspParameters</span> <span class="n">cspParameters</span> <span class="o">=</span> <span class="n">new</span> <span class="n">CspParameters</span><span class="p">(</span><span class="n">ProviderRsaFull</span><span class="p">)</span>
                                      <span class="p">{</span>
                                          <span class="n">KeyContainerName</span> <span class="o">=</span> <span class="s2">&quot;MyContainerName&quot;</span><span class="p">,</span>
                                          <span class="n">Flags</span> <span class="o">=</span> <span class="n">CspProviderFlags</span>
                                              <span class="o">.</span><span class="n">UseMachineKeyStore</span><span class="p">,</span>
                                          <span class="n">ProviderName</span> <span class="o">=</span>
                                              <span class="s2">&quot;Microsoft Strong Cryptographic Provider&quot;</span>
                                      <span class="p">};</span>

    <span class="n">var</span> <span class="n">rsa</span> <span class="o">=</span> <span class="n">new</span> <span class="n">RSACryptoServiceProvider</span><span class="p">(</span><span class="n">cspParameters</span><span class="p">)</span> <span class="p">{</span> <span class="n">PersistKeyInCsp</span> <span class="o">=</span> <span class="n">true</span> <span class="p">};</span>
<span class="p">}</span>

<span class="n">public</span> <span class="n">void</span> <span class="n">DeleteKeyInCsp</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">var</span> <span class="n">cspParams</span> <span class="o">=</span> <span class="n">new</span> <span class="n">CspParameters</span> <span class="p">{</span> <span class="n">KeyContainerName</span> <span class="o">=</span> <span class="s2">&quot;MyContainerName&quot;</span> <span class="p">};</span>
    <span class="n">var</span> <span class="n">rsa</span> <span class="o">=</span> <span class="n">new</span> <span class="n">RSACryptoServiceProvider</span><span class="p">(</span><span class="n">cspParams</span><span class="p">)</span> <span class="p">{</span> <span class="n">PersistKeyInCsp</span> <span class="o">=</span> <span class="n">false</span> <span class="p">};</span>
    <span class="n">rsa</span><span class="o">.</span><span class="n">Clear</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>How to encrypt and decrypt data</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="n">byte</span><span class="p">[]</span> <span class="n">EncryptData</span><span class="p">(</span><span class="n">byte</span><span class="p">[]</span> <span class="n">dataToEncrypt</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">byte</span><span class="p">[]</span> <span class="n">cipherbytes</span><span class="p">;</span>
    <span class="n">using</span> <span class="p">(</span><span class="n">var</span> <span class="n">rsa</span> <span class="o">=</span> <span class="n">new</span> <span class="n">RSACryptoServiceProvider</span><span class="p">(</span><span class="mi">2048</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">rsa</span><span class="o">.</span><span class="n">ImportParameters</span><span class="p">(</span><span class="n">this</span><span class="o">.</span><span class="n">_publicKey</span><span class="p">);</span>
        <span class="n">cipherbytes</span> <span class="o">=</span> <span class="n">rsa</span><span class="o">.</span><span class="n">Encrypt</span><span class="p">(</span><span class="n">dataToEncrypt</span><span class="p">,</span> <span class="n">false</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">cipherbytes</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">public</span> <span class="n">byte</span><span class="p">[]</span> <span class="n">DecryptData</span><span class="p">(</span><span class="n">byte</span><span class="p">[]</span> <span class="n">dataToEncrypt</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">byte</span><span class="p">[]</span> <span class="n">plain</span><span class="p">;</span>
    <span class="n">using</span> <span class="p">(</span><span class="n">var</span> <span class="n">rsa</span> <span class="o">=</span> <span class="n">new</span> <span class="n">RSACryptoServiceProvider</span><span class="p">(</span><span class="mi">2048</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">rsa</span><span class="o">.</span><span class="n">PersistKeyInCsp</span> <span class="o">=</span> <span class="n">false</span><span class="p">;</span>
        <span class="n">rsa</span><span class="o">.</span><span class="n">ImportParameters</span><span class="p">(</span><span class="n">this</span><span class="o">.</span><span class="n">_privateKey</span><span class="p">);</span>
        <span class="n">plain</span> <span class="o">=</span> <span class="n">rsa</span><span class="o">.</span><span class="n">Decrypt</span><span class="p">(</span><span class="n">dataToEncrypt</span><span class="p">,</span> <span class="n">true</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">plain</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">public</span> <span class="n">byte</span><span class="p">[]</span> <span class="n">DecryptDataWithCsp</span><span class="p">(</span><span class="n">byte</span><span class="p">[]</span> <span class="n">dataToDecrypt</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">byte</span><span class="p">[]</span> <span class="n">plain</span><span class="p">;</span>
    <span class="n">var</span> <span class="n">cspParams</span> <span class="o">=</span> <span class="n">new</span> <span class="n">CspParameters</span> <span class="p">{</span> <span class="n">KeyContainerName</span> <span class="o">=</span> <span class="s2">&quot;MyContainerName&quot;</span> <span class="p">};</span>
    <span class="n">using</span> <span class="p">(</span><span class="n">var</span> <span class="n">rsa</span> <span class="o">=</span> <span class="n">new</span> <span class="n">RSACryptoServiceProvider</span><span class="p">(</span><span class="mi">2048</span><span class="p">,</span> <span class="n">cspParams</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">plain</span> <span class="o">=</span> <span class="n">rsa</span><span class="o">.</span><span class="n">Decrypt</span><span class="p">(</span><span class="n">dataToDecrypt</span><span class="p">,</span> <span class="n">false</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">plain</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="digital-signatures">
<h1><a class="toc-backref" href="#id9">Digital Signatures</a><a class="headerlink" href="#digital-signatures" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p>Claiming authenticity of a message</p></li>
<li><p>Digital signatures give both authentication and non-repudiation</p></li>
<li><p>Based on asymmetric cryptography</p></li>
<li><p>Digital signatures consist of: 1. Public and private key generation; 2. Signing algorithm using the private key</p></li>
<li><p>Verification algorithm using the public key</p></li>
</ul>
<p>Difference between normal asymmetric encryption and digital sign:</p>
<ul class="simple">
<li><p>normal asymmetric encryption: sender use public key to encrypt data, and receiver uses private key to decrypt data</p></li>
<li><p>digital sign: sender use private key to generate digital sign, and receiver uses public key to verify the digital sign</p></li>
</ul>
<table class="docutils align-default">
<colgroup>
<col style="width: 31%" />
<col style="width: 35%" />
<col style="width: 35%" />
</colgroup>
<tbody>
<tr class="row-odd"><td></td>
<td><p>Public Key</p></td>
<td><p>Private Key</p></td>
</tr>
<tr class="row-even"><td><p>Encryption (RSA)</p></td>
<td><p>Encrypt</p></td>
<td><p>Decrypt</p></td>
</tr>
<tr class="row-odd"><td><p>Digital Signatures</p></td>
<td><p>Verify Signature</p></td>
<td><p>Sign Message</p></td>
</tr>
</tbody>
</table>
<p>Digital Signature in .NET use 3 main classes</p>
<ul class="simple">
<li><p>RSACryptoServiceProvider</p></li>
<li><p>RSAPKCS1SignatureFormatter</p></li>
<li><p>RSAPKCS1SignatureDeformatter</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="n">byte</span><span class="p">[]</span> <span class="n">SignData</span><span class="p">(</span><span class="n">byte</span><span class="p">[]</span> <span class="n">hashOfDataToSign</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">using</span> <span class="p">(</span><span class="n">var</span> <span class="n">rsa</span> <span class="o">=</span> <span class="n">new</span> <span class="n">RSACryptoServiceProvider</span><span class="p">(</span><span class="mi">2048</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">rsa</span><span class="o">.</span><span class="n">PersistKeyInCsp</span> <span class="o">=</span> <span class="n">false</span><span class="p">;</span>
        <span class="n">rsa</span><span class="o">.</span><span class="n">ImportParameters</span><span class="p">(</span><span class="n">this</span><span class="o">.</span><span class="n">_privateKey</span><span class="p">);</span>

        <span class="n">var</span> <span class="n">rsaFormatter</span> <span class="o">=</span> <span class="n">new</span> <span class="n">RSAPKCS1SignatureFormatter</span><span class="p">(</span><span class="n">rsa</span><span class="p">);</span>
        <span class="n">rsaFormatter</span><span class="o">.</span><span class="n">SetHashAlgorithm</span><span class="p">(</span><span class="s2">&quot;SHA256&quot;</span><span class="p">);</span>

        <span class="k">return</span> <span class="n">rsaFormatter</span><span class="o">.</span><span class="n">CreateSignature</span><span class="p">(</span><span class="n">hashOfDataToSign</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">public</span> <span class="nb">bool</span> <span class="n">VerifySignature</span><span class="p">(</span><span class="n">byte</span><span class="p">[]</span> <span class="n">hashOfDataToSign</span><span class="p">,</span> <span class="n">byte</span><span class="p">[]</span> <span class="n">signature</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">using</span> <span class="p">(</span><span class="n">var</span> <span class="n">rsa</span> <span class="o">=</span> <span class="n">new</span> <span class="n">RSACryptoServiceProvider</span><span class="p">(</span><span class="mi">2048</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="n">rsa</span><span class="o">.</span><span class="n">ImportParameters</span><span class="p">(</span><span class="n">this</span><span class="o">.</span><span class="n">_publicKey</span><span class="p">);</span>

        <span class="n">var</span> <span class="n">rsaDeformatter</span> <span class="o">=</span> <span class="n">new</span> <span class="n">RSAPKCS1SignatureDeformatter</span><span class="p">(</span><span class="n">rsa</span><span class="p">);</span>
        <span class="n">rsaDeformatter</span><span class="o">.</span><span class="n">SetHashAlgorithm</span><span class="p">(</span><span class="s2">&quot;SHA256&quot;</span><span class="p">);</span>

        <span class="k">return</span> <span class="n">rsaDeformatter</span><span class="o">.</span><span class="n">VerifySignature</span><span class="p">(</span><span class="n">hashOfDataToSign</span><span class="p">,</span> <span class="n">signature</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="comparision-between-hashing-mac-and-digital-sign">
<h2><a class="toc-backref" href="#id10">Comparision between hashing, MAC and digital sign</a><a class="headerlink" href="#comparision-between-hashing-mac-and-digital-sign" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Integrity: Can the recipient be confident that the message has not been accidentally modified?</p></li>
<li><p>Authentication: Can the recipient be confident that the message originates from the sender?</p></li>
<li><p>Non-repudiation: If the recipient passes the message and the proof to a third party, can the third party be confident that the message originated from the sender?</p></li>
</ul>
<table class="docutils align-default">
<colgroup>
<col style="width: 45%" />
<col style="width: 11%" />
<col style="width: 20%" />
<col style="width: 25%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Cryptographic primitive
Security Goal</p></td>
<td><p>Hash</p></td>
<td><p>MAC</p></td>
<td><p>Digital
signature</p></td>
</tr>
<tr class="row-even"><td><ul class="simple">
<li><p>Integrity</p></li>
<li><p>Authentication</p></li>
<li><p>Non-repudiation</p></li>
</ul>
</td>
<td><ul class="simple">
<li><p>Yes</p></li>
<li><p>No</p></li>
<li><p>No</p></li>
</ul>
</td>
<td><ul class="simple">
<li><p>Yes</p></li>
<li><p>Yes</p></li>
<li><p>No</p></li>
</ul>
</td>
<td><ul class="simple">
<li><p>Yes</p></li>
<li><p>Yes</p></li>
<li><p>Yes</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>Kind of keys</p></td>
<td><p>none</p></td>
<td><dl class="simple">
<dt>symmetric</dt><dd><p>keys</p>
</dd>
</dl>
</td>
<td><dl class="simple">
<dt>asymmetric</dt><dd><p>keys</p>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="secure-string">
<h1><a class="toc-backref" href="#id11">Secure String</a><a class="headerlink" href="#secure-string" title="Permalink to this headline">¶</a></h1>
<p>System.String is not a secure solution, which has the following problems:</p>
<ul class="simple">
<li><p>Several copies in memory</p></li>
<li><p>Not encrypted</p></li>
<li><p>Not mutable, old copied in memory</p></li>
<li><p>No effective way to clear out memory</p></li>
</ul>
<p>Using SecureString for sensitive data</p>
<ul class="simple">
<li><p>SecureString stored in encrypted memory</p></li>
<li><p>SecureString implements IDisposable</p></li>
<li><p>Create SecureString with a pointer to a char array</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="n">static</span> <span class="n">string</span> <span class="n">CovertToUnsecureString</span><span class="p">(</span><span class="n">SecureString</span> <span class="n">securePassword</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">var</span> <span class="n">unmanagedString</span> <span class="o">=</span> <span class="n">IntPtr</span><span class="o">.</span><span class="n">Zero</span><span class="p">;</span>
    <span class="k">try</span>
    <span class="p">{</span>
        <span class="n">unmanagedString</span> <span class="o">=</span> <span class="n">Marshal</span><span class="o">.</span><span class="n">SecureStringToGlobalAllocUnicode</span><span class="p">(</span><span class="n">securePassword</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">Marshal</span><span class="o">.</span><span class="n">PtrToStringUni</span><span class="p">(</span><span class="n">unmanagedString</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">finally</span>
    <span class="p">{</span>
        <span class="n">Marshal</span><span class="o">.</span><span class="n">ZeroFreeGlobalAllocUnicode</span><span class="p">(</span><span class="n">unmanagedString</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">private</span> <span class="n">static</span> <span class="n">SecureString</span> <span class="n">ToSecureString</span><span class="p">(</span><span class="n">char</span><span class="p">[]</span> <span class="nb">str</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">var</span> <span class="n">secureString</span> <span class="o">=</span> <span class="n">new</span> <span class="n">SecureString</span><span class="p">();</span>
    <span class="n">Array</span><span class="o">.</span><span class="n">ForEach</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">secureString</span><span class="o">.</span><span class="n">AppendChar</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">secureString</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">private</span> <span class="n">static</span> <span class="n">char</span><span class="p">[]</span> <span class="n">CharacterData</span><span class="p">(</span><span class="n">SecureString</span> <span class="n">secureString</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">char</span><span class="p">[]</span> <span class="nb">bytes</span><span class="p">;</span>
    <span class="n">var</span> <span class="n">ptr</span> <span class="o">=</span> <span class="n">IntPtr</span><span class="o">.</span><span class="n">Zero</span><span class="p">;</span>

    <span class="k">try</span>
    <span class="p">{</span>
        <span class="n">ptr</span> <span class="o">=</span> <span class="n">Marshal</span><span class="o">.</span><span class="n">SecureStringToBSTR</span><span class="p">(</span><span class="n">secureString</span><span class="p">);</span>
        <span class="nb">bytes</span> <span class="o">=</span> <span class="n">new</span> <span class="n">char</span><span class="p">[</span><span class="n">secureString</span><span class="o">.</span><span class="n">Length</span><span class="p">];</span>
        <span class="n">Marshal</span><span class="o">.</span><span class="n">Copy</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">secureString</span><span class="o">.</span><span class="n">Length</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">finally</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ptr</span> <span class="o">!=</span> <span class="n">IntPtr</span><span class="o">.</span><span class="n">Zero</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Marshal</span><span class="o">.</span><span class="n">ZeroFreeBSTR</span><span class="p">(</span><span class="n">ptr</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nb">bytes</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><em>Written by Binwei&#64;Oslo</em></p>
</div>

  <div class="section">
  
    


<div class="section">
  <span style="float: left;">
  
  
  <a href="../docker_introduction/">
    <i class="fa fa-arrow-circle-left"></i>
    Docker Introduction
  </a>
  
  </span>
  <span>&nbsp;</span>
  <span style="float: right;">
  
  
  <a href="../the_personal_mba/">
    The Personal MBA
    <i class="fa fa-arrow-circle-right"></i>
  </a>
  </span>
  
</div>

  
  
    <div class="section">
    <h2>Comments</h2>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'wubw-github-io';
        var disqus_identifier = '/2018/cryptography_introduction/';
        var disqus_title = 'Cryptography Introduction (with .NET code example)';
        var disqus_url = 'https://wubw.github.io/2018/cryptography_introduction';

        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
  
  </div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../../">
    <img class="logo" src="../../_static/logo.jpg" alt="Logo"/>
    
  </a>
</p>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=wubw&repo=BinweiBlog&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>






  
  
  <h2>
  
  <i class="fa fa-calendar"></i>
    07 January 2018
  
  </h2>

  <ul>
    

  

  

  

  
  <li id="category"><span><i class="fa-fw fa fa-folder-open"></i></span>
    
      
      <a href="../../blog/category/computerscience/">ComputerScience</a>
      
    </li>
  

  
  <li id="tags"><span><i class="fa-fw fa fa-tag"></i></span>
    
      
      <a href="../../blog/tag/security/">security</a>
      
    </li>
  
  
  <li id="comments">
    <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'wubw-github-io'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
    </script>
    <i class="fa-fw fa fa-comments"></i>
    <a href="#disqus_thread" data-disqus-identifier="/2018/cryptography_introduction/"> </a>
  </li>
  
  </ul>


<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../about/">About binwei</a></li>
</ul>


  <h3><a href="../../blog/">Recent Posts</a></h3>
  <ul>
    
    
      <li><a href="../../2020/mac_tips/">31 July - Mac Tips</a></li>
    
      <li><a href="../../2020/about_consulting/">10 July - About Consulting</a></li>
    
      <li><a href="../../2020/xiao_gou_qian_qian/">09 July - Book note: Xiao Gou Qian Qian</a></li>
    
      <li><a href="../../2020/intelligent_web_sentences/">07 June - Intelligent Web Sentences</a></li>
    
      <li><a href="../../2020/arduino_introduction/">16 May - Arduino Introduction</a></li>
    
  </ul>

  <h3><a href="../../blog/tag/">Tags</a></h3>
  <style type="text/css">
    ul.ablog-cloud {list-style: none; overflow: auto;}
    ul.ablog-cloud li {float: left; height: 20pt; line-height: 18pt; margin-right: 5px;}
    ul.ablog-cloud a {text-decoration: none; vertical-align: middle;}
    li.ablog-cloud-1{font-size: 80%;}
    li.ablog-cloud-2{font-size: 95%;}
    li.ablog-cloud-3{font-size: 110%;}
    li.ablog-cloud-4{font-size: 125%;}
    li.ablog-cloud-5{font-size: 140%;}
  </style>
  <ul class="ablog-cloud">
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/ai/">ai</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/architecture/">architecture</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/backend/">backend</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/blockchain/">blockchain</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/blog/">blog</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-5">
        <a href="../../blog/tag/booknotes/">booknotes</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-2">
        <a href="../../blog/tag/career/">career</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-2">
        <a href="../../blog/tag/chinese/">chinese</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-2">
        <a href="../../blog/tag/cloud/">cloud</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/consulting/">consulting</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/continuousdelivery/">continuousdelivery</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/database/">database</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/devops/">devops</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/docker/">docker</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/efficiency/">efficiency</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/frontend/">frontend</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-2">
        <a href="../../blog/tag/git/">git</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/hardware/">hardware</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/investment/">investment</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/iot/">iot</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/lean/">lean</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/nosql/">nosql</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/opensource/">opensource</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-2">
        <a href="../../blog/tag/process/">process</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/reading/">reading</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/sales/">sales</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-3">
        <a href="../../blog/tag/security/">security</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/shell/">shell</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/smartcity/">smartcity</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/telemetry/">telemetry</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/vi/">vi</a></li>
      
    
      
      <li class="ablog-cloud ablog-cloud-1">
        <a href="../../blog/tag/web/">web</a></li>
      
    
  </ul>

  <h3><a href="../../blog/category/">Categories</a></h3>
  <ul>
  
    
    <li><a href="../../blog/category/business/">Business (1)</a></li>
    
  
    
    <li><a href="../../blog/category/computerscience/">ComputerScience (38)</a></li>
    
  
    
    <li><a href="../../blog/category/general/">General (1)</a></li>
    
  
    
    <li><a href="../../blog/category/life/">Life (3)</a></li>
    
  
    
    <li><a href="../../blog/category/literature/">Literature (3)</a></li>
    
  
    
    <li><a href="../../blog/category/management/">Management (14)</a></li>
    
  
  </ul>

  <h3><a href="../../blog/archive/">Archives</a></h3>
  <ul>
  
    
    <li><a href="../../blog/2020/">2020 (7)</a></li>
    
  
    
    <li><a href="../../blog/2019/">2019 (8)</a></li>
    
  
    
    <li><a href="../../blog/2018/">2018 (11)</a></li>
    
  
    
    <li><a href="../../blog/2017/">2017 (34)</a></li>
    
  
  </ul>

<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search/" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, binwei.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/2018/cryptography_introduction.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-97414429-1']);
      _gaq.push(['_setDomainName', 'none']);
      _gaq.push(['_setAllowLinker', true]);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
    
  </body>
</html>